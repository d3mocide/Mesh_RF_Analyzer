services:
  app:
    image: ghcr.io/d3mocide/meshrf:latest
    container_name: meshrf
    # ports:
    #   - "5173:80"
    environment:
      # Hostname for reverse proxy
      - ALLOWED_HOSTS=localhost
      # Default Map Center (Portland, OR)
      - VITE_MAP_LAT=45.5152
      - VITE_MAP_LNG=-122.6784
    # No volumes needed for production artifact
    # volumes:
    #   - .:/app
    #   - /app/node_modules
    # command: npm run dev -- --host

  rf-engine:
    image: ghcr.io/d3mocide/meshrf-rf-engine:latest
    container_name: rf_engine
    ports:
      - "5001:5001"
    environment:
      # Elevation Data Configuration
      # Using local OpenTopoData service
      - ELEVATION_API_URL=http://opentopodata:5000
      
      # Dataset to use: ned10m (High res US) or srtm30m (Global)
      # User must download .hgt/.tif files to ./data/opentopodata
      - ELEVATION_DATASET=${ELEVATION_DATASET:-ned10m}
    volumes:
      - ./cache:/app/cache

    restart: unless-stopped
    depends_on:
      - redis

  redis:
    image: redis:alpine
    user: root
    ports:
      - "6379:6379"
    volumes:
      - ./redis_data:/data
    restart: always

  opentopodata:
    image: ghcr.io/d3mocide/meshrf-opentopodata:latest
    container_name: opentopodata
    ports:
      - "5000:5000"
    volumes:
      - ./data/opentopodata:/app/data
    restart: unless-stopped
